## 4. 일반화된 포워딩 및 소프트웨어 기반 네트워크(SDN)
목적지 IP 주소를 찾은(매치) 후 패킷을 지정된 출력 포트로 스위치 구조를 통해 전송(액션)하는 **목적지 기반 포워딩**은 **매치 플러스 액션**이다. **액션**은 하나 이상의 출력 포트로 패킷을 전달하고, 인터페이스에서 나가는 패킷을 로드 밸런싱해 헤더를 다시 쓰고, 의도적으로 패킷을 차단/삭제 및 특수 서버로 패킷을 보내는 등의 **작업을 수행**한다.

일반화된 포워딩에서 "매치 플러스 액션" 태이블은 **목적지 기반 포워딩의 개념을 일반화**한다. 즉, 단순히 목적지 IP 주소 뿐만이 아니라 다양한 패킷 필드를 조합하여 패킷의 처리를 결정한다.(매치 플러스 액션 테이블 사용)여기서 라우터 대신에 **패킷 스위치**로 좀 더 정확하게 부른다. 

![](https://velog.velcdn.com/images/choiyoung6609/post/9cfcf21d-3c08-45a8-9338-cc698a733ad0/image.png)

각 패킷 스위치는 **매치 플러스 액션 테이블**을 가지고 있고, 테이블은 원격 컨트롤러에 의해 **계산, 설치, 갱신**된다. 개별 패킷 스위치의 제어 구성요소가 서로 상화작용할 수는 있지만 **매치 플러스 액션 테이블은 원격 컨트롤러에 의해 구현되고 계산, 설치, 갱신**된다. 
일반화된 포워딩에 대한 논의는 **OpenFlow 기반**이다. OperFlow의 **플로우 테이블**로 알려진 "매치 플러스 액션" 포워딩 테이블의 각 엔트리는 다음 내용을 포함한다

- 들어오는 패킷에 대한 **헤더값들의 세트**가 매치될 것이다. 하드웨어 TCAM이 신속하게 처리하며, 플로우 테이블과 매치되지 않는 값은 **원격 컨트롤러로 전송 될 수 있다.**(새로운 플로우 엔트리를 생성하거나 적절한 처리 결정)
- 패킷들에 의해 갱신되는 **카운터세트**는 플로우 테이블 엔트리들과 매치된다. 즉, 특정 플로우 엔트리와 **매치된 패킷**이 있을 때마다 **카운터가 증가**한다. 이러한 카운터는 플로우 테이블 엔트리와 마지막으로 갱신된 테이블 엔트리 이후에 매치된 다수의 패킷을 포함하고 있다.(모니터링 가능)
- 패킷이 플로우 테이블 엔트리와 매치될 때 **여러 액션이 가능해진다** 이러한 액션도 플로우 테이블 엔트리에 포함된다. 

### 4.1 매치
![업로드중..](blob:https://velog.io/8eae6a56-a8d3-4ed9-976e-6d714e9efccf)

openflow 1.0 "매치 플러스 액션" 규칙에서 매치될 수 있는 대상은 **11개의 패킷 헤더 필드오 수신 포트 ID**이다. 여기서 IP 주소가 아닌 **이더넷 주소를 기반**으로 전달함으로써 OpenFlow 지원 장치가 스위치 포워딩 프레임뿐만 아니라 라우터 **포워딩 데이터그램과 동일한 성능을** 발휘할 수 있음을 알 수 있다. IP주소가 아닌 **이더넷 주소**는 데이터 링크 계층에서 사용되는 **물리적 주소(MAC)**를 의미한다. 최근 OpenFlow에서는 41개의 값으로 증가했다.

여기서 진입 포트는 **패킷이 수신되는 패킷 스위치의 입력 포트**를 나타낸다. 이 진입 포트를 Openflow 매치 플러스 규칙에 집어넣은 이유는 **네트워크 트래픽 제어**를 할때 특정 포트로 들어온 패킷만 허용하거나, 우선순위를 부여할 때 필요하기 때문이다. 또한, **같은 목적지로 들어오는 패킷이라도 다른 입력 포트로 들어왔다면 다른 액션**을 취할 수 있기 때문이다. 

플로우 테이블 엔트리에는 **와일드카드**도 있을 수 있다. 예를 들어 128.119.*.+ 주소는 앞의 128.119 필드만 일치하다면 이 필드와 매치되는 것이다. 만약 여러 개가 매치됐다면 가장 **높은 우선순위를 가지는 엔트리와 매치**된다.

마지막으로 IP 헤더 필드의 모든 값이 매치될 수 있는 것은 아니다. 예를 들어 데이터그램 필드의 길이나 TTL 필드에 기반한 매치는 허용하지않는다. **왜 어떤 필드는 허용하고 어떤 필드는 허용하지 않을까?** 이는 **이는 복잡성과 기능성 간의 균형(tradeoff)**와 관련이 있다. 
- 기능성 : 네트워크 장치를 유연하게 제어할 수 있도록 설계되었음. 모든 필드를 매칭에 사용하면 더 많은 기능성을 제공하지만, 복잡성 증가함.
- 복잡성 : 모든 필드를 매치하여 복잡해지고 비효율적이 됨.

따라서 OpenFlow는 단순하면서도 필요한 기능은 유지하는데 초점을 맞추고 있다. 

### 4.2 액션
**각 플로우 테이블 엔트리는 0개 이상의 액션 목록을 가지고 있다.** 여러 액션이 있는 경우 **순서대로 수행**한다. 
- **포워딩** : 들어오는 패킷은 **출력 포트로 전달**되거나, **모든 포트로 브로드캐스트**되거나, **선택된 포트 세트를 통해 멀티캐스트(특정 그룹에게 전달)**될 수 있다. 또한, 캡슐화되어 원격 컨르롤러에 전송된 후 **새 플로우 테이블 엔트리를 설치**하고 **포워딩을 위해 패킷을 장치로 반환**할 수 있다.(아무 조치도 안할 수도 있음)
- **삭제** : 아무 액션이 없는 엔트리는 매치된 패킷을 **삭제**한다.
- **필드 수정** : 패킷이 선택된 출력 포트로 전송되기 전에 **10개의 패킷 헤더 필드의 값을 다시** 쓸 수 있다.

### 4.3 매치 플러스 액션 작업의 OpenFlow 예
일반화된 포워딩 매치 플러스 액션 작업에서는 플로우 테이블을 조작하여 **간단한 포워딩, 로드 밸런싱, 방화벽**의 기능을 하도록 조작할 수 있다. 이러한 **매치 플러스 액션 플로우 테이블**은 사실 **제한된 형태의 프로그래밍 가능성**이다. 
