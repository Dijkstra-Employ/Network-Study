# 네트워크 계층 : 데이터 평면

앞 전에서는 트랜스포트 계층이 **네트워크 계층 호스트들 간의 통신 서비스에 의존함**으로써 프로세스 간의 통신을 제공한다는 것을 배웠다. 또한, 트랜스포트 계층은 네트워크 계층이 어떻게 구현되었는지 알지 못해도 동작한다는 것을 알았다. 

이번 장에서는 네트워크 계층이 호스트들에게 어떤 통신 서비스를 제공하는지 알아볼 것이다. 또한, **애플리케이션 계층이나 트랜스포트 계층과는 다르게 각 호스트와 네트워크의 라우터마다 네트워크 계층의 일부가 존재한다는 사실**을 알게 될 것이다. 

네트워크 계층은 크게 두 가지로 나눌 수 있다.(**떼이터 평면과 제어 평면**). 4장에서는 먼저 네트워크 계층에서의 데이터 평면이 어떤 기능을 하는지 다룰 것이다. **라우터별 제어는 입력 링크에 도착한 데이터그램을 출력  링크에 어떻게 도착할지를 결정**한다. 여기서 전톡적인 IP 포워딩과 일반화된 포워딩에 대해 배울 것이다. 5장에서는 네트워크 계층의 제어 평면 기능(송신자에서 수신자까지 라우터를 어떻게 지나갈 것인지 결정하는 것)을 다룰 것이다. 
 또한, 라우팅 알고리즘과 라우팅 프로토콜에 대해 배우고 제어 평면의 기능을 뚜렷하게 구분하는 SDN에 대해서도 다룰 것이다.
 
 
## 1. 네트워크 계층 개요
![](https://velog.velcdn.com/images/choiyoung6609/post/c5aeeeaf-a1bc-446b-babf-f4eec720c2a1/image.png)

간단하게 패킷이 어떻게 전달되는지 확인해보자. H1에서 데이터그램으로 캡슐된 정보는 인접한 라우터 R1에게 데이터그램을 보낸다. 그리고, 호스트 H2가 데이터그램을 전달받게 되면 H2의 트랜스포트 계층까지 데이터그램을 전달한다. 네트워크 계층의 역할은 **출발지 호스트에서 목적지 호스트까지 잘 전달되게끔 로컬 포워딩, 라우터별 포워딩을 대응**시키는 것이다. 

### 포워딩과 라우팅 : 데이터 평면과 제어 평면
네트워크 계층의 역할 : 송신 호스트에서 수신 호스트까지 패킷을 전달하는 것.

- **포워딩(전달)** : 패킷이 라우터의 **입력 링크에 전달되었을 때 적절한 출력 링크로 이동시켜야 한다**. 포워딩에서 예외적으로 한 기능은 **데이터 평면**에서 실행된다. 
- **라우팅** : 송신자가 수신자에게 패킷을 전송할 때 **네트워크 계층은 패킷 경로를 결정해야 한다**. 이러한 경로를 결정하는 알고리즘을 **라우팅 알고리즘**이라고 한다. 이는 네트워크 계층의 **제어 평면**에서 실행된다. 

네트워크 계층을 논할 때 포워딩과 라우팅 용어가 서로 혼동되기는 한다. 그러나 **포워딩은 매우 짧은 시간을 가지고 대표적으로 하드웨어에서 실행된다. 그러나, 라우팅은 네트워크 전반에 걸쳐 경로를 설정하는 것이기 때문에 더 긴 시간 단위를 갖는다(보통 소프트웨어에서 실행)**.

![](https://velog.velcdn.com/images/choiyoung6609/post/6edc61e6-4805-4d84-8c19-70e88bb38cfa/image.png)


네트워크 라우터에서 필수적인 요소는 **포워딩 테이블(forwarding table)**이다. 라우터는 먼저 입력 링크로 전달되는 패킷의 헤더 필드값을 조사하여 패킷을 전달한다. 그리고 이 값을 라우터의 포워딩 테이블의 **내부 색인**으로 사용한다. 포워딩 테이블의 엔트리에 있는 헤더의 값은 해당 패킷이 전달되어야 하는 **라우터의 외부 링크 인터페이스**를 나타낸다. 이때, 헤더의 값은 패킷의 목적지 주소이거나 패킷이 속한 연결의 지시일 수 있다.
=> 포워딩은 **네트워크 계층의 데이터 평면에 의해 실행된다**

#### 제어 평면 : 전통적인 접근 방법
이러한 포워딩이 제대로 실행되기 위해서는 포워딩 테이블이 제대로 구성되어야 한다. 이것은 라우팅과 포워딩 사이의 중요한 연결고리이다. 위의 그림에서와 같이 **라우팅 알고리즘은 라우터의 포워딩 테이블 내용을 결정**한다. 
 라우팅 알고리즘은 각각의 라우터에서 실행되며, 라우터는 라우팅과 포워딩 기능을 모두 가지고 있다. 이때, **라우팅 알고리즘**은 다른 라우팅 알고리즘과 소통하여 **포워딩 테이블의 값을 계산하는 것**으로 라우팅 프로토콜에 따라 라우팅 정보에 포함된 라우팅 메세지를 교환하며 이루어진다.
 
 두 포워딩과 라우팅 기능ㅇ느 가상의 예를 이용하면 잘 설명할 수 있다. 라우터 내부에 존재하는 네트워크 운영자가 직접 설정을 한다고 할 때, 라우팅 프로토콜이 필요하지 않다. 그리고 운영자(사람)에 의해 목적지에 도착하기 위한 방법의 설정이 명확하도록 상호작용할 ㄳ이다. 
 
 
#### 제어 평면 : SDN 접근 방법
![](https://velog.velcdn.com/images/choiyoung6609/post/8928d806-d92d-46d1-93c8-cfdf00dd9882/image.png)

위의 방식은 라우팅 공급업체에 의해 지금까지 지속적으로 채택되어 왔다. 그러나 이러한 방식 말고 **원격 컨트롤러 컴퓨터와 각각의 라우터에 의해 사용될 포워딩 테이블을 분배하는 다른 접근법**도 있다. 이때, **데이터 평면 요소는 전통적인 방식과 SDN 방법 모두 동일하다.** 이떄 라우터와 원격 ㅓㄴ트롤러는 메세지를 교환하면서 소통할 수 있다. 이 방식은 네트워크가 소프트웨어 적으로 정의되었을 떄, 포워딩 테이블을 계산하는 컨트롤러는 라우터와 상호작용하며 소프트웨어에서 실행되기 때문에 SDN이라고 불린다. 

### 2. 네트워크 서비스 모델
데이터 평면을 탐구하기 전에 먼저 네트워크 계층에서 제공되는 다른 종류의 서비스를 살펴보자. **네트워크 서비스 모델**은 송수신 호스트 간 패킷 전송 특성을 정의한다.

네트워크 계층에서 제공할 수 있는 서비스
- 보장된 전달 : 출발지에서 목적지까지 전달되는 것을 보장
- 지연 제한 이내의 보장된 전달 : 전달 보장 뿐만 아니라 특정 지연 제한 안에 전달함
- 순서화 패킷 전달 : 목적지까지 순서대로 도착하는 것을 보장
- 최소 대역폭 보장 : 송수신자 사이의 특정한 비트율의 전송 링크를 애뮬레이트한다. 송신 호스트가 비트들을 특정한 비트율 이하로 전송하는 한, 모든 패킷이 수신자까지 전달된다.
- 보안 서비스 : 출발지 호스트에서 암호화, 목적지 호스트에서 해독할 수 있게 하여 기밀성을 유지

이들은 네트워크 계층에서 제공할 수 있는 일부 서비스이다. 

그러나, 인턴세 네트워크 계층은 **최선형 서비스**라고 해서, 아무것도 보장하지 않는 서비스를 이용한다. 이 서비스는 쓸모없는 것처럼 보여도 넷플릭스, 스카이프 및 페이스 타임과 같은 애플리케이션을 가능하게 할 만큼 충분히 좋다고 입증되었다.

#### 4장의 개요
용어가 서로 헷갈리는 **포워딩과 스위칭**에 대해 알아보자. **패킷 스위치**는 패킷 헤더 내부의 필드값에 따라 입력 링크에서 출력 링크 인터페이스로 패킷을 전달하는 일반적인 패킷 교환 장비를 의미한다. **링크 계층 스위치**라고 불리는 일부 패킷 스위치는 링크 계층 프레임의 필드값에 의지하여 포워딩을 결정한다. 따라서 스위치는 2계층 장비라고도 불린다. **라우터**같은 ㅐ킷 스위치는 네트워크 계층 필드값에 근거하여 포워딩을 결정한다. 이를 네트워크 계층의 장치라고 한다. 우리의 관심사는 네트워크 계층이므로 패킷 스위치 대신엥 **라우터**라는 용어를 사용하자.
