## 8.4 종단점 인증
**종단점 인증**이란 하나의 통신 개체가 다른 개체에게 **자신의 신원**을 네트워크 상으로 증명하는 작업이다. **통신이 일어난 시점**에 현재 네트워크에 연결된 상태인 **당사자 인증**에 초점을 맞춘다. 8.3 절에서 메세지가 실제 송신자가 보낸 것인지 입증하는 것과는 조금 다르다.

> MAC이나 전자서명 등을 사용하면 공격자가 A에게 보낸 내용을 엿듣고 B에게 보내 자신이 공격자가 아닌 척할 수 있다.(이미 사용된 패킷인지 확인 불가능)
**메세지 자체는 실제 송신자가 보낸 것이 맞음**

여기서 인증은 **인증 프로토콜**의 한 부분으로서 교환된 메세지와 데이터만을 기반을 수행되어야 한다. 대게 인증은 두 통신 관계자가 어떤 다른 프로토콜을 수행하기 **이전에** 수행된다.

이 장에서는 ap(authentication protocol)이라 부르는 여러 가지 버전의 인증 프로토콜을 고안하고 각 버전의 **결점**을 살펴볼 것이다. 

#### 인증 프로토콜 ap 1.0
가장 간단한 인증은 앨리스가 밥에게 "나는 앨리스다"라는 메세지를 보내는 것이다. 그러나 이는 공격자가 보낼 수도 있기 때문에 문제가 된다.

#### 인증 프로토콜 ap 2.0
![](https://velog.velcdn.com/images/choiyoung6609/post/6e5806ba-2c73-4774-bb24-114fcd97bbc8/image.png)

이미 알려진 네트워크 주소(IP 주소)를 가지고 통신을 한다면 밥은 IP 데이터그램의 출발지 주소와 앨리스의 IP 주소를 비교하여 인증을 진행할 수 있다. 그러나 사실, 공격자가 IP 주소를 속여서 데이터그램을 만들면 수신자를 속일 수 있다. 이 방법을 **IP 스푸핑**이라고 한다.

#### 인증 프로토콜 ap 3.0
![](https://velog.velcdn.com/images/choiyoung6609/post/840e11e6-0aa8-48bb-9d48-bf6dcdad2d67/image.png)

가장 고전적인 방식으로 **비밀번호**를 사용하는 것이다. 이는 인증자와 인증 받는 사람과의 **공유된 비밀**이다. 그러나, 공격자가 도청을 통해 **앨리스의 비밀번호를 도청**한다면 비밀번호를 알아낼 수 있다. 

#### 인증 프로토콜 ap 3.1
3.0의 문제를 해결하기 위해서는 먼저 **비밀번호를 암호화**하는 방법이 있다. 즉, 앨리스와 밥이 대칭 비밀키 K를 공유한다면 비밀번호를 암호화해서 밥에게 보낸다. 밥은 이 비밀번호를 복호화해서 비밀번호가 맞다면 앨리스를 인증한다. 

이는 **비밀번호**를 알아낼 수는 없지만, **재생공격**을 막지는 못한다. 즉, 도청을 통해 **암호화된 비밀번호**를 저장했다가 앨리스인 것처럼 보내는 것이다.

#### 인증 프로토콜 ap 4.0
위의 문제는 밥이 앨리스가 보낸 인증 요청 메세지와 이를 **재생한 메세지**를 구별하지 못하기 떄문에 발생하는 문제다. 따라서 **live인지 아니면 재생한 메세지**인지 구분하면 된다.

이를 위해서 **TCP 핸드쉐이크 프로토콜**이 사용된다. TCP 서버에서는 자신이 받은 SYN 세그먼트가 **이전 세그먼트의 복사본**이라면 연결을 수락하지 않을 것이다.

> **어떻게 TCP 서버는 클라이언트와의 통신이 live인지 확인할 수 있는 것일까?

먼저 서버는 오랫동안 사용되지 않은 초기 **순서 번호**를 선택하여 클라이언트에게 번호를 보내고 클라이언트가 이 **순서번호를 담는 ACK 세그먼트**로 응답하는 것을 원한다.

**넌스**는 프로토콜이 평생에 단 한 번만 사용하는 숫자를 뜻한다. 즉, 프로토콜은 **넌스**를 사용하면 이 숫자를 다신 사용하지 않는다. 

1) 앨리스는 메세지 "나는 앨리스다"를 밥에게 봰다.
2) 밥은 넌스 R을 선택하여 그것을 앨리스에게 보낸다.
3) 앨리스는 **대칭 비밀키**인 K를 사용하여 넌스를 암호화하고 K(R)을 보낸다. 밥은 자신이 보낸 메세지가 **앨리스**가 보낸 것임을 확인할 수 있다.

![](https://velog.velcdn.com/images/choiyoung6609/post/85da33e0-0116-4409-b2ef-5fa8192b00bf/image.png)

공격자가 K(R)을 도청하여 보내더라도 이미 K(R)이 밥에게 전달되었기 때문에 다시 사용할 수 없다.(live가 아닌 것을 밥이 알게 됨)
