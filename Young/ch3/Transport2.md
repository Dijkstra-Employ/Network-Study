
## 다중화와 역다중화
- 호스트와 호스트 전달 서비스에서 프로세스 대 프로세스 전달 서비스로의 확장
- **소켓**은 프로세스가 네트워크로 데이터를 전달하고, 네트워크에서 프로세스로 데이터를 전달하는 출입구 역할을 한다.
- 따라서, **트랜스포트 계층**은 실제로 **프로세스로 전달하는 것이 아닌 중간 매개제인 소켓에게 전달**한다.
- 각각의 소켓은 유일한 식별자를 가지고 구별된다.
- **다중화** : 각 데이터와 헤더 정보를 합쳐 캡슐화하고, 이런 세그먼트들을 네트워크 계층으로 전달하는 것
- **역다중화** : 트랜스포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 것
![](https://velog.velcdn.com/images/choiyoung6609/post/f0a7b230-c884-442f-977c-e6fdcbed2149/image.png)
- 다중화와 역다중화에서 요구하는 것: 
	(1) 소켓은 유일한 식별자를 갖는다.
    (2) 세그먼트는 전달될 적절한 소켓을 가리키는 특별한 필드를 갖는다.
    
    
**특별한 필드**
- 포트 번호
- 0 ~ 65535까지 16비트
- 0~1023까지의 포트번호를 **잘 알려진 포트번호**라고 하여 엄격히 제한
![](https://velog.velcdn.com/images/choiyoung6609/post/bdf5420e-fc78-4e91-afeb-342bd7bc84b6/image.png)



### 비연결형 다중화와 역다중화
- UDP 생성될 때 트랜스포트 계층은 포트 번호를 자동으로 할당
- bind()를 통해서 특정 번호를 할당할 수 있음
- 일반적으로 서버 측은 특정 포트 번호를 할당하고, 클라이언트는 트랜스포트 계층이 자동으로 포트 번호를 할당함
- **UDP 소켓은 목적지 IP 주소와 목적지 포트 번호에 의해 식별됨**
- 따라서, 출발지 IP 주소나 출발지 포트 번호가 달라도 위의 주소가 같으면 같은 소켓(프로세스)로 향함


![](https://velog.velcdn.com/images/choiyoung6609/post/4163ae44-bb72-4dd9-8827-31496bb6635a/image.png)

### 연결형 다중화와 역다중화
- UDP와 다른 점은 2개가 아닌 4개 요소에 의해 소켓이 식별된다는 것이다.
- **4가지 요소 : 출발지 IP 주소, 출발지 포트 주소, 목적지 IP 주소, 목적지 포트 주소**
![](https://velog.velcdn.com/images/choiyoung6609/post/5a805029-b682-4c73-b2c2-e3668cc01874/image.png)


### 웹 서버와 TCP
- 실제로 연결 소켓과 프로세스 사이에 항상 일대일 대응이 일어나는 것은 아님
- 고성능 웹 서버는 **하나의 프로세스만 사용**하고, 각각의 새로운 클라이언트 연결을 위해 새로운 연결 소켓과 함께 **새로운 스레드를 생성**한다.
- 비지속적인 HTTP 사용 시 소켓의 생성과 종료가 빈번하게 일어나고, 웹 서버 성능에 심한 부담을 준다.
