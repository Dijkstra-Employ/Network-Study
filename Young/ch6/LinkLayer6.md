## 6.6 데이터 센터 네트워킹
대규모 인터넷 기업들은 대부분 수만 대의 호스트를 지원하는 대규모 데이터 센터를 구축하고 있다. 이런 데이터 센터는 **인터넷에 연결**되어 있을 뿐만 아니라, 내부에서도 연결되는 자체 **데이터 센터 네트워크**를 가지고 있다.

이때 데이터 센터 네트워크는 세 가지 목적을 수행한다. 
1) 외부 클라이언트에게 콘텐츠 제공 
2) 병렬 컴퓨팅 인프라스트럭처 역할 
3) 다른 회사에게 **클라우드 컴퓨팅 제공**


### 6.6.1 데이터 센터 구조
![](https://velog.velcdn.com/images/choiyoung6609/post/fdf95cae-753a-4a66-8eeb-b94c2b52939e/image.png)

데이터 센터는 호스트를 **블레이드**라고 부르고, 이러한 블레이드들은 20~40개씩 모여서 **랙(Rack)**에 적재된다. 랙의 맨 위에는 **TOR 스위치**가 있다. 이 TOR 스위치는 랙에 있는 호스트들을 서로 연결시켜 주고 데이터 센터의 다른 스위치와 연결된다. 랙에 있는 호스트는 NIC 카드를 통해 TOR 스위치에 연결된다. 

데이터 센터에서는 외부 클라이언트의 접속을 지원하기 위해서 **경계 라우터**를 가지며, 데이터 센터 네트워크를 인터넷으로 연결해준다. 

#### 로드 밸런싱

클라우드 데이터 센터는 여러 애플리케이션을 동시에 제공한다.(검색, 전자메일 등) 외부 클라이언트로부터의 요청을 지원하기 위해 애플리케이션에는 **공용 IP** 주소가 할당되며, 클라이언트는 이 주소로 요청을 보내고, 응답을 받는다. 이때 **로드밸런서**에서는 요청을 호스트로 분배하고, **부하를 균등**하게 한다. 여러 대의 로드 밸런서가 있을 경우 각 로드 밸런서는 **특정 클라우드 애플리케이션**을 위해 사용된다.

로드 밸런서는 **IP 주소**뿐만 아니라 **목적지 포트 번호**를 보고 결정하기 떄문에 **4계층 스위치**라고 하기도 한다. 로드 밸런서가 요청을 받으면 해당 애플리케이션을 처리하는 호스트 중 하나로 요청을 전달한다. 또한, 호스트의 공용 외부 IP 주소를 **내부 IP 주소**로 변환해주고, 내부 IP 주소를 **공용 외부 IP 주소**로 변환해준다.(NAT 기능과 유사) - 네트워크 구조를 숨기고 보안성 제공

#### 계층적 구조
위의 사진처럼 기존 계층 구조는 확장성 문제를 해결하기는 하지만 호스트-호스트 간의 **용량을 제한**하는 문제가 있다. 예를 들어 스위치 간의 속도는 빠르지만 **호스트들간의 연결은 느릴 수 있다**. 또한, 여러 개의 플로우가 있는 경우 다른 랙에 있는 두 호스트 간 최대 전송률은 훨씬 작아진다. 

해결방법은 아래와 같다

- **고속 스위치와 라우터 사용** 이렇게 될 경우 데이터 센터의 비용이 많이 든다.
- **2단 또는 1단 스위치를 경유하는 랙 간 통신이 최소화**되도록 가능한 **같은 곳**에 위치시키는것이다. 그러나 수천 대의 호스트를 사용하는 경우 거의 불가능하다.
- **TOR 스위치와 2단 스위치, 2단 스위치와 1단 스위치 간의 연결성을 증가**시키는 것이다.(여러 연결 사용) 예를 들어 하나의 TOR 스위치와 2개의 2단 스위치를 연결하여 여러 개의 링크 비결합, 스위치 비결합 경로를 제공할 수 있다.
![](https://velog.velcdn.com/images/choiyoung6609/post/4132c7f0-ca71-4d91-a405-f735bc5d7864/image.png)
