## 6.2 오류 검출 및 정정 기술
- **비트 레벨 오류 검출 및 정정**은 링크 계층에서 제공하는 대표적인 서비스

- 링크 계층에서는 비트 오류를 감지하기 위해 송신 노드에서 데이터 D에 **오류 검출 및 정정 비트들(EDC)를 첨가**한다. 

- 데이터 D는 네트워크 계층의 데이터 그램 뿐만 아니라 **링크 계층의 헤더**도 포함한다. 

- 이러한 수신자의 오류 검출 및 정정 기술은 **항상은 아니지만, 거의 모든 비트 오류를 검출**할 수 있다. 

- 오류를 검출하지 못할 수도 있기 때문에 **오류 발생 확률이 낮은 오류 검출 기법 사용**이 중요하다. 

- 대표적인 오류 검출 기법인 **패리티 검사**, **체크섬**, **순환 중복 검사**를 알아보자.

![](https://velog.velcdn.com/images/choiyoung6609/post/fa70732f-1a5b-450f-8d77-74d939d04bd0/image.png)


### 6.2.1 패리티 검사
- 가장 단순한 형태의 오류 검출은 **단일 패리티 비트**를 사용하는 것이다. 
- **짝수 패리티 기법** : 데이터 D(비트 d개)에 하나의 비트를 추가하여 1의 개수가 짝수가 되도록 만드는 기법이다. 
- **홀수 패리티 기법** : 데이터 D(비트 d개)에 하나의 비트를 추가하여 1의 개수가 홀수가 되도록 만드는 기법이다. 

 ![](https://velog.velcdn.com/images/choiyoung6609/post/b38e628b-17d3-4609-b81b-d5f9d9a88e5c/image.png)


- 만약 짝수 패리티 기법 사용했을 때 홀수개의 1이 나왔으면 **임의의 홀수개의 오류**가 발생했음을 알 수 있다. 
- 그러나, 짝수 패리티 기법 사용했을 때, 짝수 개가 나온다면 **오류 검출에 실패할 수도 있다.**
 - 오류는 **버스트 형태**로 밀려 오기 떄문에 단일 비스트 패리티에 미검출 오류가 있을 확률은 **50%**가 된다. 
 
 - 이번에는 오류 정정 기술에 대한 이해를 좁기 위해 **비트 패러티를 일반화**하는 방법을 살표보자
 
![](https://velog.velcdn.com/images/choiyoung6609/post/288da8e0-dd8b-4a80-b1e1-c27671b5f308/image.png)

- 위의 그림은 단일 패리키 기법을 **2차원**으로 일반화한 것이다.
- 2차원 비트에서는 열과 행을 이용해서 **단일 비트 오류를 검출**할 수 있을 뿐만 아니라, **정정**까지 가능해진다. 

- 오류를 검출 및 정정하는 수신자의 능력을 **순방향 오류 정정(FEC)**라고 한다. 이 기술은 오디오 저장 및 재생 장치에서 만힝 사용된다.
- FEC 기술은 송신자에게 요구하는 재전송 횟수를 줄일 수 있다는 장점이 있다.(**즉각적인 오류 정정도 가능**)

### 6.2.2 체크섬 방법체크섬 방법
![](https://velog.velcdn.com/images/choiyoung6609/post/2af915b2-def9-4996-8053-08a724b78c1e/image.png)

- 데이터를 구성하는 d 비트들은 몇 개의 k비트 개의 정수처럼 나눌 수 있다.(ex) 16비트짜리 4개) 그리고 이 비트를 **인터넷 체크섬**에서 사용한다. 이 값의 1의 보수가 **인터넷 체크섬**이 되고, **세그먼트 헤더**에 넣어준다. 

- tcp와 udp는 헤더와 데이터 모두 체크섬을 계산하기 때문에 IP 에서는 IP 헤더에 대해서만 체크섬을 계산하면 된다.
- 체크섬 방식은 **오버헤드가 적지만**, CRC와 비교하면 오류 면에서는 상대적으로 취약하다. 
- 트랜스포트 계층은 호스트 운영체제의 일부로 **소프트웨어로 구현**되기 때문에, 체크섬처럼 간단하고 빠른 오류 검출 기법이 필요하다.
- 링크 계층에서는 **하드웨어로 구현**되므로, **더 복잡한 CRC 연산**이 가능하다. 


### 6.2.3 순환 중복 검사(CRC)
![](https://velog.velcdn.com/images/choiyoung6609/post/c8449102-3625-421c-bc00-e30bfa283fc1/image.png)

- 오늘날 컴퓨터 네트워크에서 널리 사용되는 오류 검출 기술은 **순환 중복 검사(CRC)** 이다. 

- CRC 코드는 **다항식 코드**로도 알려졌는데, 전송되는 비트열에 있는 0과 1 값을 계수로 갖는 다항식처럼 비트열을 생각할 수 있기 떄문이다.


![](https://velog.velcdn.com/images/choiyoung6609/post/754adfe2-f352-4b3d-ab86-043d5a4fcfd4/image.png)
- CRC 코드의 동작 방식은 d 비트로 이루어진 데이터 D를 전송할 때 송신자와 수신자가 미리 **G로 표기되는 생성자**로 알려진 r + 1 비트 패턴에 대해 합의한다. G의 최상위 비트는 **항상 1이여야 한다.** 
- d + r 개의 수신 비트를 모듈로 2 연산을 이용하면 G로 정확히 나눠진다. 그러도록 나머지를 r로 만들어주는 것

- 이때 수신자는 d + r 개의 수신 비트를 G로 나누고 나머지가 0이 아니면 오류가 발생한 것이고 , 아니라면 데이터가 멀쩡한 것이다. 

- 이때 모듈로 2 연산이란 **이진수끼리의 나눗셈**으로 덧셈의 올림과 뺄셈의 빌림이 필요없다.(XOR 연산과 동일하게 처리)

D*2^r XOR R = nG
=> G로 나누어 떨어질 수 있도록 R을 선택해야 된다.

여기에 XOR R 덧셈을 하면 
D*2^r = nG XOR R
=> 이 식을 G로 나누면
R = 나머지*D*2^r/G 가 된다.
