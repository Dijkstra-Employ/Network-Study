## 3. 인터넷에서의 AS 내부 라우팅 : OSPF
지금까지 우리는 네트워크를 **단순히 상호 연결된 라우터 집합 덩어리**로 보았다. 모든 라우터가 같은 라우팅 알고리즘을 사용하고, 라우팅 경로를 계산한다는 점에서 그렇다. 그러나, **모든 네트워크를 동종의 라우터 집합**으로 바라보는 것은 2가지 이유로 **지나치게 단순**하다.
- 확장 : 수억 개의 라우터로 구성되어 있는데 하나의 집합으로 볼 경우 모든 라우팅 정보를 저장할 수 없다. 또한, DV 알고리즘을 사용할 경우 **너무 많이 반복되는 알고리즘** 때문에 절대 **수렴하지 않는다.**
- 관리 자율성 : 인터넷의 ISP는 각자 잣니의 라우터들로 네트워크를 관리하고 싶어한다. 

이러한 두 가지 문제는 **라우터들을 자율 시스템(AS)로 조직화하여 해결**한다. 하나의 ISP는 하나의 AS를 가지기도 하고 여러 AS로 구성되기도 한다. AS는 **AS 번호로 식별**되며 ICANN의 지역 등록 기관에 의해 할당된다. 이렇게 AS 내부에서 동작하는 라우팅 알고리즘을 **AS 내부 라우팅 알고리즘**이라고 한다.

#### 개방형 최단 우선(OSPF) 프로토콜
OSPF는 **링크 상태 정보를 플러딩**하는 **다익스트라 최소 비용 경로 알고리즘**을 사용한다. 개별 링크 비용은 네트워크 관리자가 구성한다.(모든 링크 1 설정 또는 링크 용량에 반비례하게 설정)

OSPF를 사용하는 라우터는 **링크 상태가 변경**되거나, **주기적**으로 링크 상태를 **브로드캐스팅**한다. OSPF 메세지(3계층-네트워크)는 인터넷 프로토콜로 보내지는데 상위 계층 프로토콜 번호(IP 헤더의 Protocol 필드)에는 **89**번으로 기록된다. OSPF 프로토콜은 따라서 **신뢰할 수 있는 메세지 전송**과 **링크 상태의 브로드캐스트**와 같은 기능을 스스로 구현해야 한다. 또한, **링크가 동작하고 있는지 검사**하고, OSPF 라우터가 이웃 라우터의 데이터베이스를 얻을 수 있도록 해야 한다.
또한 다음과 같은 기능도 한다.

- **보안** : OSPF 라우터들 간의 정보 교환을 인증하여 신뢰성을 높인다. 두 종류의 인증이 있는데, **단순 인증** 또는 **MD5**를 사용한다. 단순 인증은 **동일한 패스워드가 각 라우터에 설정**된다. 그러나, 라우터가 OSPF 패킷을 보낼 때 패스워드를 **평문**으로 포함하기 때문에 안전하지는 않다. **MD5**인증은 **공유 비밀키**를 기반으로 이루어지기 떄문에 단순인증보다는 안전하다.

- **복수 도일 비용 경로** : 같은 비용을 가지는 여러 경로가 있을 경우 여러 경로를 모두 사용할 수 있다.

- **유니캐스트와 멀티캐스트 라우팅의 통합 지원** : MOSPF는 멀티캐스트 라우팅 기능을 제공하기위해 OSPF를 확장했다.(새로운 형태의 링크 상태 알림 추가)

- **단일 AS 내에서의 계층 지원** : OSPF의 AS는 **계층적인 영역**으로 구ㅂ성될 수 있다. 같은 지역 라우터들끼리만 브로드캐스트하며 하나 또는 여러 개의 **영역 경계라우터**가 영역 외부로의 라우팅을 책임진다. 그리고 AS에서 오직 하나의 OSPF 영역만이 **백본 영역**으로 설정된다. 백본 영역의 주요 역할은 **AS 내 영역 간의 트래픽을 라우팅**하고, **모든 영역 경계 라우터를 포함**하는 것이다. **AS 내 영역 간 라우팅을 위해** 먼저 영역 경계 라우터로 패킷을 라우팅하고(**영역 내**), **백본을 통과해**, **목적지 영역의 영역 경계 라우터로 라우팅**한 후, 최종 목적지로 라우팅한다.
