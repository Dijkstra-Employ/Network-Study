## 소프트웨어 정의 네트워크(SDN) 제어 평면
SDN 장치끼리의 패킷 전달을 제어하는 네트워크 전체 로직과 SDN 장치, SDN 서비스의 설정과 관리를 포함하는 **SDN 제어 평면**에 대해 알아보자

SDN 장치는 일반적인 SDN 포워딩에 기반하고 있기 때문에 목적지 뿐만 아니라 여러 패킷 헤더 필드의 값에 기반하여 패킷을 전달한다.(ex) OpenFlow 1.0)

- **플로우 기반 포워딩** : 목적지 뿐만 아니라 여러 헤더값을 기반으로 포워딩할 수 있다.(플로우 테이블)
- **데이터 평면과 제어 평면의 분리** : 데이터 평면은 여러 스위치(단순하고 빠름)로 구성되어 있고, 제어 평면은 서버와 스위치들의 플로우 테이블을 결정, 관리하는 소프트웨어로 이루어져 있다.
- **네트워크 제어 기능이 데이터 평면 스위치 외부에 존재** : 
위에 데이터 평면과 제어 평면이 분리되어 있다고 했다. 이렇게 분리된 제어 기능은 스위치 내부에서 분리된 것이 아니라 **외부에 존재**한다.(별도의 서버) 제어 평면은 개의 구성 요소 **SDN 컨트롤러, 네트워크 제어 애플리케이션**의 집합으로 이루어져 있다. 
컨트롤러는 스위치에 대한 정보 등을 유지하고 이를 네트워크 제어 애플리케이션에 제공하며, 애플리케이션들이 제어할 수 있도록 한다. 

- **프로그램이 가능한 네트워크** : 네트워크 제어 애플리케이션을 통해 네트워크를 프로그램할 수 있다.(데이터 평면 제어)

![](https://velog.velcdn.com/images/choiyoung6609/post/cf51308a-2119-426b-9d94-81aa688dea42/image.png)

=> **이러한 특징을 통해 SDN은 네트워크 기능들의 "분리"를 의미함을 알 수 있다.**


### 1. SDN 제어 평면: SDN 컨트롤러와 SDN 네트워크 애플리케이션
먼저 SDN의 기능을 살펴보기 위해서 SDN 컨트롤러에 대해 살펴보자. SDN은 **크게 3가지 계층**으로 구성된다.

![](https://velog.velcdn.com/images/choiyoung6609/post/e91ed21e-95d0-44a8-aa57-6b99ceb0b565/image.png)
</br>

- **통신 계층: SDN 커트롤러와 제어받는 장치들 간의 통신** 
SDN 컨트롤러가 다른 장치들을 제어하기 위해서는 장치의 정보를 알아야 하고, 그 사이에 정보를 전달하는 **프로토콜(대표적으로 OpenFlow)**이 필요하다. 이러한 프로토콜은 SDN 컨트롤러에게 최신의 정보를 제공한다. 
컨트롤러와 제어받는 장치들 간의 통신은 **사우스 바운드**라는 컨트롤러 인터페이스를 넘나든다.

- **네트워크 전역 상태 관리 계층** 
제어 평면은 제어 결정을 위해 컨트롤러가 다른 장치들에 대한 최신 정보를 알아야 한다. 다른 제어 장치들의 플로우 테이블을 결정하기 위해서 컨트롤러도 이 테이블들의 복사본을 유지해야 하낟. 이는 SDN 컨트롤러가 유지하는 **네트워크 전역 상태**의 예이다.(물리적으로 분산되어 있지만 전역 상태를 유지해야 함)

- **네트워크 제어 애플리케이션 계층과의 인터페이스**
컨트롤러와 네트워크 제어 애플리케이션 간의 컨트롤러 인터페이스를 **노스바운드**라고 한다. 이를 통해 장치들의 상태와 플로우 테이블을 읽고 쓸 수 있다. 보통 REST 요청-응답 인터페이스를 사용해 애플리케이션과 통신한다.

### 2. OpenFlow 프로토콜
OpenFlow 프로토콜은 SDN 컨트롤러와 스위치 사이에서 또는 OpenFlow API를 구현하는 다른 장치 사이에서 동작한다. TCP 상에서 default port 번호인 6653을 가지고 동작한다.

컨트롤러 -> 스위치
- **설정** : 스위치의 설정 파라미터를 문의 or 설정 가능
- **상태 수정** : 플로우 테이블의 엔트리 추가/제거 또는 수정, 스위치 포트의 특성을 설정
- **상태 읽기** : 플로우 테이블과 포트로부터 통계 정보와 카운터값을 얻기 위해 사용
- **패킷 전송** : 스위치의 지정된 포트에서 특정  패킷을 내보내기 위해 사용. 페이로드에 패킷을 포함하고 있음

스위치 -> 컨트롤러
- **플로우 제거** : 테이블 엔트리의 시간 만료나 상태 수정 메세지 수정 결과로 인한 삭제를 알림
- **포트 상태** : 포트의 상태 변화를 알림
- **패킷 전달** : 플로우 테이블과 일치하지 않는 패킷을 전달하거나 일치하더라도 어떠한 정책에 의해 컨트롤러에게 보내짐


### 3. 데이터 평면과 제어 평면의 상호작용 : 예제
다음은 스위치와 컨트롤러 간의 상호작용 예이다. 이때, 다익스트라 알고리즘을 이용해서 최단 경로를 결정하는데 이전과 다르게 **모든 라우터에 구현되고 갱신 정보가 모든 라우터에 플러딩되는 라우터별 제어** 시나리오와 다른 점이 있다.
- 다익스트라 알고리즘이 스위치 외부에서 별도로 수행됨
- 패킷 스위치들이 링크 갱신 정보를 SDN 컨트롤러에게 전송함
  
![](https://velog.velcdn.com/images/choiyoung6609/post/36fa3999-0fcd-45af-b5ac-54abd1c70663/image.png)

위의 그림처럼 s1과 s2 사이의 링크가 단절되었다고 하자. 여기서 통신 계층 프로토콜은 OpenFlow가 사용되었다.

1. 스위치 s2와의 단절을 감지한 s1은 OpenFlow의 **포트 상태** 메세지를 통해 SDN 컨트롤러에게 알린다.
2. SDN 컨트롤러는 링크 상태 관리자에게 이를 알리고, 관리자는 **링크 상태 데이터베이스를 갱신**한다.
3. 네트워크 제어 애플리케이션은 링크 상태의 변화가 있을 경우 알림을 받도록 설정했기 때문에 알람을 전달 받는다.
4. 네트워크 제어 애플리케이션은 링크 상태 관리자에게 요청하여 링크 상태를 가져온다. 그리고 최소 비용 경로를 계산한다.
5. 링크 상태 라우팅 애플리케이션은 플로우 테이블 관리자와 접촉하여 플로우 테이블을 갱신한다. 
6. 플로우 테이블 관리자는 OpenFLow 프로토콜을 사용해 **링크 상태 변화에 영향을 받는 플로우 테이블**을 갱신한다.
