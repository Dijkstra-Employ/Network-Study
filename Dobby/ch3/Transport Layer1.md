## 트랜스포트 계층과 네트워크 계층의 관계

트랜스포트 계층 프로토콜들은 종단 시스템에 존재한다.

종단 시스템 안에서 프랜스포트 프로토콜은 애플리케이션 프로세스에서 네트워크 경계(네트워크 계층)까지 메시지를 운반하며, 또한 반대 방향으로 네트워크 계층에서 애플리케이션 프로세스로 메시지를 운반한다.

그러나 트랜스포트 프로토콜은 메시지가 네트워크 계층 내부에서 어떻게 이동하는지는 언급하지 않는다.

<br />

## IP

인터넷의 `네트워크 계층 프로토콜`은 인터넷 프로토콜이라는 이름을 갖는다.

IP 서비스 모델은 호스트들 간에 논리적 통신을 제공하는 최선형 전달 서비스이다.

이는 IP가 통신하는 호스트들 간에 세그먼트를 전달하기 위해 최대한 노력하지만, 어떤 보장도 하지 않는다는 것을 의미한다.

특히, IP는 세그먼트의 전달을 보장하지 않고, 세그먼트가 순서대로 전달되는 것을 보장하지 않는다.

IP는 세그먼트 내부 데이터의 무결성을 보장하지 않는다.

이러한 이유로 IP를 비신뢰적 서비스라고 부른다.

<br />

## UDP

UDP는 IP와 마찬가지로 비신뢰적인 전송을 제공한다.

하나의 프로세스에 의해 전송된 데이터가 손상되지 않고 목적지 프로세스에 도착한다는 것을 보장하지 않는다.

<br />

## TCP

신뢰적인 데이터 전송을 제공하며 흐름 제어, 순서 번호, 확인 응답, 타이머를 사용함으로써 TCP는 송신하는 프로세스로부터 수신하는 프로세스에게 데이터가 순서대로 정확하게 전달되도록 확실하게 한다.

이처럼 TCP는 종단 시스템 간에 IP의 비신뢰적인 서비스를 프로세스 사이의 신뢰적인 데이터 전송 서비스로 만들어준다.

TCP는 혼잡한 네트워크 링크에서 각 TCP 연결이 링크의 대역폭을 공평하게 공유하여 통과하도록 해준다.

이는 송신측의 TCP가 네트워크에 보낼 수 있는 트래픽을 조절함으로써 수행된다.

반면 UDP 트래픅은 조절되지 않는다.

UDP 전송 프로토콜을 사용하는 애플리케이션은 허용되는 한 만족하는 어떤 속도로든 전송할 수 있다.

<br />

## Multiplexing / Demultiplexing

다중화와 역다중화는 모든 컴퓨터 네트워크에서 필요하다.

와이파이든, LTE든 네트워크는 한 기기당 하나에 연결되어 있다.

TCP와 UDP가 공통되게 제공하는 기능이다.

<br />

### Multiplexing

그렇기에 여러 프로그세스에서 하나의 소켓으로 데이터가 전송된다는 의미로 `Multiplexing`이라고 한다.

트랜스포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업을 의미한다.

<br />

### Demultiplexing

반대로 하나의 통로에서 여러 목적지 프로세스에게 데이터를 전달한다는 의미로 `Demultiplexing` 이라고 한다.

출발지 호스트에서 소켓으로부터 데이터를 모으고, 이에 대한 세그먼트를 생성하기 위해 각 데이터에 헤더 정보로 캡슐화하고, 그 세그먼트들을 네트워크 계층으로 전달하는 작업을 의미한다.

<br />

### UDP

`connectionless`

소켓과 소켓 사이의 1:1 매핑이라는 개념이 없다.

**destination 포트 번호**만 보고 Multiplexing, Demultiplexing을 지원한다.

<br />

### TCP

`connection-oriented`

소켓과 소켓이 1:1 매핑된다.

TCP 소켓들은 고유의 포트번호를 가진다기 보다는, 고유의 id(인덱스)를 가진다.

id(인덱스)는 `source id 주소` , `source port 번호` , `destination id 주소` , `destination port 번호`

이 네가지가 하나로 합쳐서 TCP 소켓의 이름이 되는 것이며 구분하는 것이다.

그래서 이 네 가지 쌍으로 Multiplexing, Demultiplexing을 지원한다.

하나의 프로세스는 여러 소켓을 가질 수 있다.

소켓과 포트는 같은 개념이 아니다.

즉, 포트 번호가 프로세스의 ID인 것이 아니다.

하나의 포트 번호에 여러 프로세스가 연결되어 있을 수 있다.

각각의 고유한 인덱스를 가지고 프로세스를 구분한다.

호스트의 각 소켓은 포트 번호를 할당받는다.

그리고 세그먼트가 호스트에 도착하면, 트랜스포트 계층은 세그먼트 안의 목적지 포트 번호를 검사하고 상응하는 소켓으로 세그먼트를 보내게 된다.

그러면 세그먼트의 데이터는 소켓을 통해 해당되는 프로세스로 전달된다.
