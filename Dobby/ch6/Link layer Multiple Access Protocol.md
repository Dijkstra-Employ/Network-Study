## 링크 계층

링크 계층의 기본 서비스는 단일 통신 링크상으로 데이터그램을 한 노드에서 인접 노드로 이동시키는 것이지만, 서비스의 세부 사항은 링크에 적용되는 특정 링크 계층 프로토콜을 따른다.

- 프레임화
  - 거의 모든 링크 계층 프로토콜은 네트워크 계층 데이터그램을 링크상으로 전송하기 전에 링크 계층 프레임에 캡슐화한다.
- 링크 접속
  - MAC 프로토콜은 링크상으로 프레임을 전송하는 규칙을 명시한다.
  - 송신자는 링크가 사용되지 않을 때마다 프레임을 전송할 수 있다.
  - 하나의 브로드캐스트 링크를 여러 노드가 공유하는 경우, MAC 프로토콜은 여러 노드로부터의 프레임 전송을 조정한다.
- 신뢰적 전달
  - 링크 계층의 신뢰적 전달 서비스는 무선 링크처럼 오류율이 높은 링크에서 주로 사용되며, 트랜스포트 계층 프로토콜이나 애플리케이션 계층 프로토콜이 데이터를 종단 간에 재전송하는 방식을 취하는 것과는 달리 링크 계층 프로토콜은 오류가 발생한 링크에서 정정한다.
  - 낮은 비트 오류율을 가진 유선 링크 링크에서는 불필요한 오버헤드가 될 수 있다. 대부분의 링크 계층 프로토콜은 신뢰적 전달 서비스를 제공하지 않는다.
- 오류 검출과 정정
  - 대부분의 링크 계층 프로토콜은 오류를 검출하는 방법을 제공한다.
  - 링크 계층에서의 오류 검출은 일반적으로 복잡하며, 하드웨어로 구현된다.
  - 오류 정정은 프레임 안의 오류 검출뿐만 아니라 프레임의 어느 곳에서 오류가 발생했는지 정확하게 찾아낼 수 있다는 점을 제외하면 오류 검출과 비슷하다.

<br />

## 링크 계층이 구현되는 위치

대부분의 링크 계층은 네트워크 인터페이스 컨트롤러(NIC)로 알려진 네트워크 어댑터에 구현된다.

네트워크 어댑터의 중심에는 링크 계층 컨트롤러가 있으며, 링크 계층 컨트롤러는 링크 계층 서비스(프레임화, 링크 접속, 오류 검출 등)의 대다수가 구현되어 있는 단일의 특수 용도 칩이다.

링크 계층 컨트롤러의 기능 대부분은 하드웨어로 구현되며, 일부 기능은 호스트 CPU에서 실행되는 소프트웨어로 구현되어 있다.

즉, 링크 계층은 하드웨어와 소프트웨어의 조합이다.

<br />

## 오류 검출 및 정정 기술

### 패리티 검사

가장 단순한 형태의 오류 검출은 단일 패리티 비트의 사용이다.

- 짝수 패리티 기법
- 홀수 패리티 기법

![image](https://github.com/user-attachments/assets/a6f3f961-02d0-45da-bd17-0b55f3350ad1)

수신자는 수신된 d + 1개의 비트들에서 1의 개수를 계산하면 된다.

<br />

### 체크섬 방법

체크섬 기술에서는 k비트 정수들을 더해서 그 결과값을 오류 검출 비트들로 사용하는 것이다.

인터넷 체크섬에서 이 방법을 사용한다.

데이터의 바이트를 16비트 정수 단위로 취해서 더한다.

체크섬 방법은 상대적으로 패킷 오버헤드가 적다.

<br />

### 순환 중복 검사 (CRC)

오늘날 컴퓨터 네트워크에서 널리 사용되는 오류 검출 기술로 CRC 코드를 사용한다.

<img src="https://github.com/user-attachments/assets/a703b39d-ada1-43cb-a222-a42b58ecc127" width="60%" />

<br />

## 다중 접속 프로토콜

브로드캐스트 링크는 동일한 하나의 공유된 브로드캐스트 채널에 다수의 송신 노드 및 수신 노드가 연결된다.

이더넷과 무선 랜은 브로드캐스트 링크 기술의 대표적인 예이다.

2개 이상의 노드가 동시에 프레임을 전송하게 되면 충돌이 발생하게 되며, 충돌에 관련된 모든 프레임은 손실되고 브로드캐스트 채널은 충돌 기간만큼 낭비된다.

다중 접속 프로토콜은 채널 분할 프로토콜, 랜덤 접속 프로토콜, 순번 프로토콜의 세 가지로 분류할 수 있다.

<br />

### **채널 분할 프로토콜**

채널을 공유하는 모든 노드가 브로드캐스트 채널의 대역폭을 분할할 수 있게 해주는 두 가지 기술인 시분할 다중화(TDM)와 주파수 분할 다중화(FDM)로 나뉜다.

- TDM

  TDM은 시간을 시간 프레임으로 나누고 각 시간 프레임을 N개의 시간 슬롯으로 나눈다.

  그 뒤에 각 시간 슬롯은 N개 노드에게 각각 할당된다.

  노드는 전송할 패킷이 있을 때마다 TDM프레임에서 자신에게 할당된 시간 슬롯 동안 패킷 비트들을 전송한다.

  하지만 이는 단점이 있다.

  1. 전송할 패킷이 있는 노드가 단 하나인 경우에도 노드 전송률이 평균 R/N으로 제한된다.
  2. 노드가 전송 순서상 자신의 차례를 항상 기다려야 한다.

- FDM

  TDM은 브로드캐스트 채널을 시간으로 공유하지만, FDM은 Rbps의 채널을 다른 주파수로 나눠서 각 주파수를 N개 노드 중 하나에게 할당한다.

  그러나 FDM은 TDM과 같은 주요 단점이 있다.

  - 전송할 패킷을 가진 노드가 단 하나일지라도 노드는 R/N의 대역폭으로 한정된다.

  - CDMA(코드 분할 다중 접속)

  다른 코드를 각 노드에게 할당한다.

  그러면 노드는 전송하는 데이터 비트들을 자신의 유일한 코드로 인코딩한다.

  다른 노드들에 의해 전송이 간섭되더라도 각 수신자들이 송신자의 인코딩된 데이터 비트를 정확하게 수신할 수 있는 훌륭한 특성이 있다.

<br />

### 랜덤 접속 프로토콜

다중 접속 프로토콜의 두 번째 종류는 랜덤 접속 프로토콜이다.

랜덤 접속 프로토콜에서 전송 노드는 항상 채널의 최대 전송률인 Rbps로 전송한다.

충돌이 생기면 충돌과 관련된 각 노드는 프레임이 충돌 없이 전송될 때까지 자신의 프레임을 계속해서 재전송한다.

대신, 그 프레임을 재전송하기 전에 랜덤 지연 시간 동안 기다린다.

충돌과 관련된 각 노드는 자신만의 랜덤 지연 시간을 선택한다.

충돌했던 노드 중 하나는 다른 노드가 선택한 지연 시간보다 충분히 작은 지연 시간을 선택함으로써 충돌 없이 자신의 프레임을 채널로 전송할 수 있다.

가장 일반적인 랜덤 접속 프로토콜로는 알로하 프로토콜, CSMA 프로토콜이 있다.

- **알로하(ALOHA)**
  순수 알로하(pure ALOHA)로 알려진 이 프로토콜에서는 프레임이 도착하면, 즉 네트워크 계층 데이터그램이 송신 노드의 네트워크 계층으로부터 아래로 전달되면 노드는 즉시 그 프레임 전체를 브로드캐스트 채널로 전송한다.
  만일 전송된 프레임이 하나 이상의 다른 전송과 충돌하면, 노드는 확률 p로 그 프레임을 즉시(자신의 충돌된 프레임이 완전히 전송된 다음에) 재전송한다.
  즉시 재전송하지 않는 경우, 노드는 프레임 전송 시간 동안 기다린다.
  노드는 기다리고 나서 그 프레임을 확률 p로 전송하거나 아니면 확률 1 - p로 다른 프레임 시간 동안 기다린다.
- **CSMA**
  알로하에서 노드가 전송 여부를 결정하는 것은 브로드캐스트 채널에 접속되어 있는 다른 노드의 활성 여부와 무관하다.
  노드는 전송 시작 시 다른 노드의 전송 여부는 주의하지 않을 뿐만 아니라, 만일 다른 노드가 자신의 전송을 간섭하는 경우에도 자신의 전송을 중지하지 않는다.
  이와 달리 CSMA는 두 가지 규칙을 가지면서 이와 같은 문제를 보완한다.
  이 두 규칙은 CSMA, CSMA/CD 프로토콜에 포함된다.
  - `캐리어 감지`
    - 노드는 전송하기 전에 채널을 듣는다.
    - 만일 다른 노드가 프레임을 채널로 전송하고 있을 경우, 노드는 임의의 짧은 시간 동안 전송 중단을 감지하면 프레임을 전송하기 시작한다.
  - `충돌 검출(collision detection)`
    - 송신 노드는 전송하면서 동시에 채널을 듣는다.
    - 만일 다른 노드가 방해 프레임을 전송하고 있음을 검출하면, 자신의 전송을 중단하고 랜덤 시간 동안 기다린 후 유휴 시 감지 및 전송 과정을 반복한다.

브로드캐스트 채널 종단 간의 채널 전파 지연(신호가 채널의 한쪽 끝에서 다른 쪽 끝으로 전파되는 데 걸리는 시간)이 CSMA의 성능을 결정하는 데 중요한 역할을 한다.

전파 지연이 길수록 네트워크의 다른 노드에서 이미 시작된 전송을 캐리어 감지 노드가 감지할 수 없는 경우가 더 증가한다.

브로드캐스트 채널에 접속된 노드의 어댑터에서 CSMA/CD 프로토콜은 다음과 같이 동작한다.

1. 어댑터는 네트워크 계층으로부터 데이터그램을 받아서 링크 계층 프레임을 만든 후에 그 프레임을 어댑터의 버퍼에 저장한다.

2. 어댑터는 채널이 유휴 상태임을 감지하면 프레임 전송을 시작한다. 만일 어댑터가 채널이 바쁜 상태임을 감지하면, 어떤 신호 에너지도 감지되지 않을 때까지 더 기다렸다가 프레임을 전송하기 시작한다.
3. 전송하는 동안 어댑터는 브로드캐스트 채널을 사용하는 다른 어댑터로부터의 신호 에너지가 있는지 감시한다.
4. 프레임 전체를 전송하는 동안 다른 어댑터로부터의 신호 에너지가 감지되지 않으면, 프레임 전송을 완료한다. 그러나 전송 도중에 다른 어댑터로부터의 신호 에너지를 감지하면, 자신의 프레임 전송을 취소한다.
5. 어댑터는 전송을 취소한 후 임의의 랜덤 시간만큼 기다린 후 2단계로 돌아간다.

임의의 랜덤 시간은 충돌하는 노드가 적을 때는 시간 간격을 작게 하고, 충돌하는 노드가 많을 때는 시간 간격을 크게 하여 결정한다.

CSMA/CD의 효율은 오랜 시간 동안 다수의 활성 노드들이 있을 때 충돌 없이 프레임이 채널로 전송되는 시간 비율이다.

<br />

### 순번 프로토콜

다중 접속 프로토콜에서 요구되는 두 가지 특성이 있다.

1. 단 하나의 노드만이 활성이면 그 노드가 Rbps의 처리율을 가지며,
2. M개의 노드가 활성이면 각 노드가 거의 R/Mbps의 처리율을 갖는다는 것이다.

알로하와 CSMA 프로토콜은 첫 번째 특성은 지니고 있으나 두 번째 특성은 없다.

이것이 순번 프로토콜을 개발하게 된 동기이다.

- 폴링 프로토콜

  노드 중 하나를 마스터 노드로 지정한다.

  마스터 노드는 각 노드를 라운드 로빈 방식으로 폴링한다.

  특히, 마스터 노드는 먼저 노드 1에게 노드 1이 최대로 보낼 수 있는 프레임 수에 대한 정보를 지닌 메시지를 전송한다.

  노드 1이 프레임을 보낸 다음에 마스터 노드는 노드 2에게 노드 2가 최대로 보낼 수 있는 프레임 수를 알려준다.

  이와 같이 마스터 노드는 순환적으로 각 노드를 폴링하는 방식으로 이 과정을 계속한다.

  [ 단점 ]

  1. 폴링 지연(노드가 전송할 수 있음을 알리는 데 걸리는 시간)
  2. 마스터 노드가 고장 나면 전체 채널이 동작하지 못하게 된다.

- 토큰 전달 프로토콜
  마스터 노드가 없고, 토큰이라고 알려진 작은 특수 목적 프레임이 정해진 순서대로 노드 간에 전달된다.
  토큰을 수신했을 때 전송할 프레임이 있을 때만 토큰을 붙잡아 프레임을 최대 개수까지 전송한 뒤 토큰을 다음 노드로 전달한다.

[ 단점 ]

1. 노드 하나가 실패하면 전체 채널이 동작하지 않는다.
2. 노드가 잘못해서 토큰을 놓아주지 않으면 토큰이 다시 돌 수 있도록 하는 회복 절차가 실행되어야만 한다.
